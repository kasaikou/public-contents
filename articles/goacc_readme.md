---
title: Goã®æ§‹é€ ä½“ã«ã‚¢ã‚¯ã‚»ã‚µãƒ¼ã‚’ä½œã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä½œã£ã¦ã¿ãŸ
emoji: ğŸ˜‡
type: tech
topics: [go, golang, goè¨€èª, ã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼]
published: false
---

## ã“ã®è¨˜äº‹ã¯ä½•ã®è¨˜äº‹ï¼Ÿ

[goacc](https://github.com/kasaikou/goacc)ã¨è¨€ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½œã£ãŸã®ã§ãã®æ—¥æœ¬èªç‰ˆREADMEã§ã™ã€‚æœ€åˆã‹ã‚‰è‹±èªã®READMEã‚’æ›¸ãã®ã¯ã¨ã¦ã‚‚ç–²ã‚Œã¦ã—ã¾ã†ã®ã§ã€ä¸€åº¦æ—¥æœ¬èªã§æ›¸ãå†…å®¹ã‚’æ•´ç†ã—ã¦ã‹ã‚‰æ›¸ã“ã†ã¨æ€ã£ãŸã€ã¨è¨€ã†ã ã‘ã§ã®è¨˜äº‹ã§ã™ã€‚


Go ã«ã‚¢ã‚¯ã‚»ã‚µãƒ¼ã‚’ã¤ã‘ã‚‹ç³»ã®ã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã®æ™‚ç‚¹ã§Goã‚‰ã—ããªã„é–‹ç™ºãªä¸Šã«Nç•ªç…ã˜æ„ŸãŒå¦ã‚ãªã„ã§ã™ãŒã€å°‘ã€…ãŠä»˜ãåˆã„ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚

# Abstract

Go ã«ã‚¢ã‚¯ã‚»ã‚µãƒ¼ãªã©ãªã©è‰²ã€…ãªã‚‚ã®ã‚’ã¤ã‘ã‚‹ã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä½œã‚Šã¾ã—ãŸã€‚

https://github.com/kasaikou/goacc

ç¾æ™‚ç‚¹ã§ä»¥ä¸‹ã®ã‚ˆã†ãªæ©Ÿèƒ½ã‚’ä½œã‚Šã¾ã—ãŸã€‚

- æ§‹é€ ä½“ã®ã‚¿ã‚°ã«ã‚ˆã‚‹è¨­å®šç®¡ç†
- ãƒ“ãƒ«ãƒ€ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ `XxxBuilder` ã‚’è‡ªå‹•ä½œæˆã—ã€Goæ§‹é€ ä½“ã®åˆæœŸåŒ–æ©Ÿèƒ½
  - `goaccPreNewHook()`, `goaccPostNewHook()` ã§ã®ãƒ•ãƒƒã‚¯é–¢æ•°ã®å‘¼ã³å‡ºã—
- ã‚¢ã‚¯ã‚»ã‚µãƒ¼ã®è‡ªå‹•ä½œæˆ
- `MarshalJSON` ã®è‡ªå‹•ä½œæˆ

# Install

`go install` ã—ã¦ãã ã•ã„ã€‚

```sh
go install github.com/kasaikou/goacc@latest
```

# Usage

## Simple Usage

ä»¥ä¸‹ã®ã‚ˆã†ãªGoãƒ•ã‚¡ã‚¤ãƒ« `models/sample.go` ã‚’ä½œæˆã—ã¾ã™ã€‚

```go
package models

type Sample struct {
	name string `goacc:"required,get,json"`
	piyo int    `goacc:"optional,get,json(,omitempty)"`
	hoge string `goacc:"optional,get,set"`
}
```

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¯¾è±¡ã¨ãªã‚‹ã‚ˆã†ã« `goacc` ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```sh
goacc -i "models/**/*.go"
```

ã™ã‚‹ã¨ `models/sample_goacc.go` ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã™ã€‚
ã‚ã¾ã‚Šã«é•·ã„ã®ã§è¦ç‚¹ã ã‘ã¾ã¨ã‚ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

```go
// Code generated by github.com/kasaikou/goacc, DO NOT EDIT.

// NewSampleBuilder ã¯ SampleBuilder ã‚’ä½œæˆã™ã‚‹
func NewSampleBuilder(name string) SampleBuilder { /*...*/ }

// SampleBuilder ã¯ Sample æ§‹é€ ä½“ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ãƒ“ãƒ«ãƒ€ãƒ¼
type SampleBuilder interface {
	SetPiyo(piyo int) SampleBuilder     // Piyo ã‚’è¨­å®šã™ã‚‹
	SetHoge(hoge string) SampleBuilder  // Hoge ã‚’è¨­å®šã™ã‚‹
	Build() *Sample                     // Sample æ§‹é€ ä½“ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹
}

// Sample æ§‹é€ ä½“ã®ã‚¢ã‚¯ã‚»ã‚µãƒ¼

func (__s *Sample) Name() string { /*...*/ }

func (__s *Sample) Piyo() int { /*...*/ }

func (__s *Sample) Hoge() string { /*...*/ }

func (__s *Sample) SetHoge(hoge string) { /*...*/ }

func (__s *Sample) MarshalJSON() ([]byte, error) { /*...*/ }
```

:::details `models/sample_goacc.go` ã‚³ãƒ¼ãƒ‰å…¨æ–‡

```go
// Code generated by github.com/kasaikou/goacc, DO NOT EDIT.
// defaultTag=-
package tests

import "encoding/json"

type SampleBuilder interface {
	SetPiyo(piyo int) SampleBuilder
	SetHoge(hoge string) SampleBuilder
	Build() *Sample
}

// sampleBuilderImpl is an instance for generating an instance of Sample.
type sampleBuilderImpl struct {
	__s *Sample
}

// NewSampleBuilder creates an SampleBuilder instance.
func NewSampleBuilder(
	name string,
) SampleBuilder {
	__s := &Sample{}

	__s.name = name

	return &sampleBuilderImpl{__s: __s}
}

func (__sb *sampleBuilderImpl) SetPiyo(piyo int) SampleBuilder {
	if __sb == nil {
		panic("sampleBuilderImpl is nil")
	} else if __sb.__s != nil {
		__sb.__s.piyo = piyo
		return __sb
	}

	panic("Sample has been already purged")
}

func (__sb *sampleBuilderImpl) SetHoge(hoge string) SampleBuilder {
	if __sb == nil {
		panic("sampleBuilderImpl is nil")
	} else if __sb.__s != nil {
		__sb.__s.hoge = hoge
		return __sb
	}

	panic("Sample has been already purged")
}

// Build purges Sample instance from sampleBuilderImpl.
//
// If calls other method in sampleBuilderImpl after Purge called, it will be panic.
func (__sb *sampleBuilderImpl) Build() *Sample {
	if __sb == nil {
		panic("sampleBuilderImpl is nil")
	} else if __sb.__s != nil {
		__s := __sb.__s
		__sb.__s = nil

		return __s
	}

	panic("Sample has been already purged")
}

func (__s *Sample) Name() string {
	if __s != nil {
		return __s.name
	}

	panic("Sample is nil")
}

func (__s *Sample) Piyo() int {
	if __s != nil {
		return __s.piyo
	}

	panic("Sample is nil")
}

func (__s *Sample) Hoge() string {
	if __s != nil {
		return __s.hoge
	}

	panic("Sample is nil")
}

func (__s *Sample) SetHoge(hoge string) {
	if __s != nil {
		__s.hoge = hoge
	}
}

func (__s *Sample) MarshalJSON() ([]byte, error) {

	type SampleJSONContent struct {
		Name string `json:"name"`
		Piyo int    `json:"piyo,omitempty"`
	}

	return json.Marshal(SampleJSONContent{
		Name: __s.name,
		Piyo: __s.piyo,
	})
}
```

:::

## Struct tags

`goacc` ã§ã¯æ§‹é€ ä½“ã®ã‚¿ã‚°ã‚’è¦‹ã¦ä½•ã‚’å®Ÿè£…ã™ã‚‹ã‹ã‚’é¸æŠã—ã¾ã™ã€‚

```go
type Sample struct {
	name string `goacc:"required,get,json"`
	piyo int    `goacc:"optional,get,json(,omitempty)"`
	hoge string `goacc:"optional,get,set"`
}
```

ã‚¿ã‚°åã¯ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§èª­ã¾ã‚Œã¦ã„ãã¾ã™ã€‚

| ã‚¿ã‚°å | ã©ã†ã„ã†ã“ã¨ã‚’ã™ã‚‹ã®ã‹
| :--: | :---
| required | è¨­å®šãŒå¿…è¦ãªãƒ¡ãƒ³ãƒãƒ¼å¤‰æ•°ã¨ã—ã¦ `NewXxxBuilder` å‘¼ã³å‡ºã—æ™‚ã®å¼•æ•°ã«ãªã‚Šã¾ã™ã€‚
| optional | è¨­å®šãŒå¯èƒ½ãªãƒ¡ãƒ³ãƒãƒ¼å¤‰æ•°ã¨ã—ã¦ `(*XxxBuilder).SetHoge` ã¨è¨€ã†å½¢ã§ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ã‚¤ãƒ³ç”¨ã®é–¢æ•°ã‚’ä½œæˆã—ã¾ã™ã€‚
| get | èª­ã¿å–ã‚Šã‚¢ã‚¯ã‚»ã‚µãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚
| getptr | ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã¨ã—ã¦èª­ã¿å–ã‚Šã‚¢ã‚¯ã‚»ã‚µãƒ¼ã‚’ä½œæˆã—ã¾ã™ï¼ˆãƒ¡ãƒ³ãƒãƒ¼é–¢æ•°ã®å‘¼ã³å‡ºã—ãªã©ã®ãŸã‚ã«ç”¨æ„ã—ã¦ã„ã¾ã™ï¼‰ã€‚
| set | æ›¸ãè¾¼ã¿ã‚¢ã‚¯ã‚»ã‚µãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚
| json(xxx) | `MarshalJSON` ä½œæˆæ™‚ã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦è¿½åŠ ã—ã¾ã™ã€‚æ‹¬å¼§å†…ã®æ–‡å­—åˆ—ã¯ `encoding/json` ã§ç”¨ã„ã‚‹ `json` ã‚¿ã‚°ã¨ã—ã¦æ¸¡ã•ã‚Œã¾ã™ã€‚

## Builder Generation

`goacc` ã§ã¯ `required`, `optional` ãŒè¨­å®šã•ã‚ŒãŸæ§‹é€ ä½“ `Xxx` ã«å¯¾ã—ã¦ `XxxBuilder`ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ï¼‰ã¨ãã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ãŸã‚ã® `NewXxxBuilder` é–¢æ•°ã‚’å®šç¾©ã—ã¾ã™ã€‚

```go
func NewSampleBuilder(name string) SampleBuilder { /*...*/ }

type SampleBuilder interface {
	SetPiyo(piyo int) SampleBuilder     // Piyo ã‚’è¨­å®šã™ã‚‹
	SetHoge(hoge string) SampleBuilder  // Hoge ã‚’è¨­å®šã™ã‚‹
	Build() *Sample                     // Sample æ§‹é€ ä½“ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹
}
```

`required` ã§è¨­å®šã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯Builderã‚’åˆæœŸåŒ–ã™ã‚‹éš›ã® `NewXxxBuilder` é–¢æ•°ã®å¼•æ•°ã¨ãªã‚Šã¾ã™ã€‚

ãã‚Œã«å¯¾ã—ã¦ã€ `optional` ã§è¨­å®šã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ `XxxBuilder` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹å†…ã§ `SetOptional` ã¨ã„ã†å½¢ã§ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®šç¾©ã•ã‚Œã¾ã™ã€‚

### Hook methods

ã¾ãŸã€Builderã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ•ãƒƒã‚¯é–¢æ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

| é–¢æ•°å®šç¾© | å‘¼ã³å‡ºã•ã‚Œã‚‹å ´æ‰€ | æƒ³å®šç”¨é€”
| :--- | :--- | :---
| `goaccPreBuildHook()` | required ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒè¨­å®šã•ã‚Œã‚‹å‰ï¼ˆæ§‹é€ ä½“ãŒåˆæœŸåŒ–ã•ã‚ŒãŸçŠ¶æ…‹ï¼‰ | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®åˆæœŸåŒ–ãªã©
| `goaccPostBuildHook()` | `(XxxBuilder).Build()` å†…ã® `return` ç›´å‰ | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’åŸ‹ã‚ã‚‹ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ `panic()` ã‚’ç™ºç”Ÿã•ã›ã‚‹ãªã©
| `goaccPostBuildHook() error` | (XxxBuilder).Build()` å†…ã® `return` ç›´å‰ | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãªã©



## Accessor Generation

### `get`

### `getptr`

### `set`

## `MarshalJSON` Generation

# Motivation

# ãŠã‚ã‚Šã«

ã¾ã å®Ÿè£…ã—ã¦ã„ãªã„æ©Ÿèƒ½ã¯è‰²ã€…ã‚ã‚Šã€å…ƒã€…ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã§ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’å‰æã«ç½®ã„ã¦ã„ãŸã®ã§ã€å‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¸ã®å¯¾å¿œã‚„æ’ä»–å‡¦ç†ãªã©ã§ãã¦ã„ãªã„ã“ã¨ãŒå¤šã„ã§ã™ã€‚ã‚ã¨å€‹äººçš„ã«ã¯range-over-funcå¯¾å¿œã‚‚è¡Œã£ã¦ã„ããŸã„ã§ã™ã€‚

ã¾ã å€‹äººçš„ã«ä½¿ã†ãŸã‚ã®æœ€ä½é™ã®æ©Ÿèƒ½ã—ã‹ä½œã£ã¦ã„ãªã„ã®ã§ã‚‚ã†å°‘ã—æ©Ÿèƒ½è¿½åŠ ã‚’è¡Œã£ã¦ã„ãã¾ã™ã€‚

èˆˆå‘³ã‚ã‚‹äººã¯ä½¿ã£ã¦ã¿ã¦ãã ã•ã„ã€‚
